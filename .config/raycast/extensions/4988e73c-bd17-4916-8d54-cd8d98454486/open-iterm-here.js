"use strict";var be=Object.create;var S=Object.defineProperty;var $e=Object.getOwnPropertyDescriptor;var ye=Object.getOwnPropertyNames;var we=Object.getPrototypeOf,ke=Object.prototype.hasOwnProperty;var xe=(e,t)=>{for(var r in t)S(e,r,{get:t[r],enumerable:!0})},N=(e,t,r,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of ye(t))!ke.call(e,a)&&a!==r&&S(e,a,{get:()=>t[a],enumerable:!(n=$e(t,a))||n.enumerable});return e};var $=(e,t,r)=>(r=e!=null?be(we(e)):{},N(t||!e||!e.__esModule?S(r,"default",{value:e,enumerable:!0}):r,e)),ve=e=>N(S({},"__esModule",{value:!0}),e);var Ne={};xe(Ne,{default:()=>fe});module.exports=ve(Ne);var x=require("react");var C=require("@raycast/api");var d=require("react");var h=$(require("react")),l=require("@raycast/api");var G=$(require("node:child_process")),K=require("node:buffer"),m=$(require("node:stream")),H=require("node:util");var J=require("react/jsx-runtime");var U=globalThis;var E=e=>!!e&&typeof e=="object"&&typeof e.removeListener=="function"&&typeof e.emit=="function"&&typeof e.reallyExit=="function"&&typeof e.listeners=="function"&&typeof e.kill=="function"&&typeof e.pid=="number"&&typeof e.on=="function",O=Symbol.for("signal-exit emitter"),M=class{constructor(){if(this.emitted={afterExit:!1,exit:!1},this.listeners={afterExit:[],exit:[]},this.count=0,this.id=Math.random(),U[O])return U[O];Object.defineProperty(U,O,{value:this,writable:!1,enumerable:!1,configurable:!1})}on(t,r){this.listeners[t].push(r)}removeListener(t,r){let n=this.listeners[t],a=n.indexOf(r);a!==-1&&(a===0&&n.length===1?n.length=0:n.splice(a,1))}emit(t,r,n){if(this.emitted[t])return!1;this.emitted[t]=!0;let a=!1;for(let s of this.listeners[t])a=s(r,n)===!0||a;return t==="exit"&&(a=this.emit("afterExit",r,n)||a),a}},W=class{onExit(){return()=>{}}load(){}unload(){}},D=class{#o;#t;#e;#s;#i;#a;#n;#r;constructor(t){this.#o=process.platform==="win32"?"SIGINT":"SIGHUP",this.#t=new M,this.#a={},this.#n=!1,this.#r=[],this.#r.push("SIGHUP","SIGINT","SIGTERM"),globalThis.process.platform!=="win32"&&this.#r.push("SIGALRM","SIGABRT","SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT"),globalThis.process.platform==="linux"&&this.#r.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT"),this.#e=t,this.#a={};for(let r of this.#r)this.#a[r]=()=>{let n=this.#e.listeners(r),{count:a}=this.#t,s=t;if(typeof s.__signal_exit_emitter__=="object"&&typeof s.__signal_exit_emitter__.count=="number"&&(a+=s.__signal_exit_emitter__.count),n.length===a){this.unload();let i=this.#t.emit("exit",null,r),o=r==="SIGHUP"?this.#o:r;i||t.kill(t.pid,o)}};this.#i=t.reallyExit,this.#s=t.emit}onExit(t,r){if(!E(this.#e))return()=>{};this.#n===!1&&this.load();let n=r?.alwaysLast?"afterExit":"exit";return this.#t.on(n,t),()=>{this.#t.removeListener(n,t),this.#t.listeners.exit.length===0&&this.#t.listeners.afterExit.length===0&&this.unload()}}load(){if(!this.#n){this.#n=!0,this.#t.count+=1;for(let t of this.#r)try{let r=this.#a[t];r&&this.#e.on(t,r)}catch{}this.#e.emit=(t,...r)=>this.#l(t,...r),this.#e.reallyExit=t=>this.#c(t)}}unload(){this.#n&&(this.#n=!1,this.#r.forEach(t=>{let r=this.#a[t];if(!r)throw new Error("Listener not defined for signal: "+t);try{this.#e.removeListener(t,r)}catch{}}),this.#e.emit=this.#s,this.#e.reallyExit=this.#i,this.#t.count-=1)}#c(t){return E(this.#e)?(this.#e.exitCode=t||0,this.#t.emit("exit",this.#e.exitCode,null),this.#i.call(this.#e,this.#e.exitCode)):0}#l(t,...r){let n=this.#s;if(t==="exit"&&E(this.#e)){typeof r[0]=="number"&&(this.#e.exitCode=r[0]);let a=n.call(this.#e,t,...r);return this.#t.emit("exit",this.#e.exitCode,null),a}else return n.call(this.#e,t,...r)}},L=null,Se=(e,t)=>(L||(L=E(process)?new D(process):new W),L.onExit(e,t));function Ee(e,{timeout:t}={}){let r=new Promise((o,c)=>{e.on("exit",(f,p)=>{o({exitCode:f,signal:p,timedOut:!1})}),e.on("error",f=>{c(f)}),e.stdin&&e.stdin.on("error",f=>{c(f)})}),n=Se(()=>{e.kill()});if(t===0||t===void 0)return r.finally(()=>n());let a,s=new Promise((o,c)=>{a=setTimeout(()=>{e.kill("SIGTERM"),c(Object.assign(new Error("Timed out"),{timedOut:!0,signal:"SIGTERM"}))},t)}),i=r.finally(()=>{clearTimeout(a)});return Promise.race([s,i]).finally(()=>n())}var F=class extends Error{constructor(){super("The output is too big"),this.name="MaxBufferError"}};function Ae(e){let{encoding:t}=e,r=t==="buffer",n=new m.default.PassThrough({objectMode:!1});t&&t!=="buffer"&&n.setEncoding(t);let a=0,s=[];return n.on("data",i=>{s.push(i),a+=i.length}),n.getBufferedValue=()=>r?Buffer.concat(s,a):s.join(""),n.getBufferedLength=()=>a,n}async function V(e,t){let r=Ae(t);return await new Promise((n,a)=>{let s=i=>{i&&r.getBufferedLength()<=K.constants.MAX_LENGTH&&(i.bufferedData=r.getBufferedValue()),a(i)};(async()=>{try{await(0,H.promisify)(m.default.pipeline)(e,r),n()}catch(i){s(i)}})(),r.on("data",()=>{r.getBufferedLength()>8e7&&s(new F)})}),r.getBufferedValue()}async function j(e,t){e.destroy();try{return await t}catch(r){return r.bufferedData}}async function Pe({stdout:e,stderr:t},{encoding:r},n){let a=V(e,{encoding:r}),s=V(t,{encoding:r});try{return await Promise.all([n,a,s])}catch(i){return Promise.all([{error:i,exitCode:null,signal:i.signal,timedOut:i.timedOut||!1},j(e,a),j(t,s)])}}function Re(e){let t=typeof e=="string"?`
`:10,r=typeof e=="string"?"\r":13;return e[e.length-1]===t&&(e=e.slice(0,-1)),e[e.length-1]===r&&(e=e.slice(0,-1)),e}function B(e,t){return e.stripFinalNewline?Re(t):t}function Te({timedOut:e,timeout:t,signal:r,exitCode:n}){return e?`timed out after ${t} milliseconds`:r!=null?`was killed with ${r}`:n!=null?`failed with exit code ${n}`:"failed"}function _e({stdout:e,stderr:t,error:r,signal:n,exitCode:a,command:s,timedOut:i,options:o,parentError:c}){let p=`Command ${Te({timedOut:i,timeout:o?.timeout,signal:n,exitCode:a})}: ${s}`,v=r?`${p}
${r.message}`:p,I=[v,t,e].filter(Boolean).join(`
`);return r?r.originalMessage=r.message:r=c,r.message=I,r.shortMessage=v,r.command=s,r.exitCode=a,r.signal=n,r.stdout=e,r.stderr=t,"bufferedData"in r&&delete r.bufferedData,r}function Ce({stdout:e,stderr:t,error:r,exitCode:n,signal:a,timedOut:s,command:i,options:o,parentError:c}){if(r||n!==0||a!==null)throw _e({error:r,exitCode:n,signal:a,stdout:e,stderr:t,command:i,timedOut:s,options:o,parentError:c});return e}async function A(e,t,r){if(process.platform!=="darwin")throw new Error("AppleScript is only supported on macOS");let{humanReadableOutput:n,language:a,timeout:s,...i}=Array.isArray(t)?r||{}:t||{},o=n!==!1?[]:["-ss"];a==="JavaScript"&&o.push("-l","JavaScript"),Array.isArray(t)&&o.push("-",...t);let c=G.default.spawn("osascript",o,{...i,env:{PATH:"/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin"}}),f=Ee(c,{timeout:s??1e4});c.stdin.end(e);let[{error:p,exitCode:v,signal:I,timedOut:de},he,pe]=await Pe(c,{encoding:"utf8"},f),me=B({stripFinalNewline:!0},he),ge=B({stripFinalNewline:!0},pe);return Ce({stdout:me,stderr:ge,error:p,exitCode:v,signal:I,timedOut:de,command:"osascript",options:r,parentError:new Error})}var y="commandWindow",Ie=()=>`
  if windows of application "iTerm" is {} then 
    set ${y} to (create window with default profile)
  else
    set ${y} to current window
  end if
  `,Ue=()=>`set ${y} to (create window with default profile)`,Oe=()=>`tell ${y} to create tab with default profile`,Le=({command:e,location:t})=>{let r=e.replace(/"/g,'\\"');return`
  tell application "iTerm"
    launch
    repeat until application "iTerm" is running
      delay 0.1
    end repeat

    ${t==="new-window"?Ue():Ie()}
    ${t==="new-tab"?Oe():""}

    tell current session of ${y}
        write text "${r}"
    end tell
    activate
  end tell`},Z=e=>{let[t,r]=(0,d.useState)(!0),[n,a]=(0,d.useState)(),[s,i]=(0,d.useState)(!1),o=(0,d.useMemo)(()=>Le(e),[e]);return(0,d.useEffect)(()=>{A(o).then(()=>i(!0)).catch(c=>a(c))},[o]),(0,d.useEffect)(()=>{(n||s)&&r(!1)},[n,s]),{loading:t,error:n,success:s}};var u=require("@raycast/api"),Y=$(require("path"));var q=$(require("path"),1);function z(e,t={}){if(typeof e!="string")throw new TypeError(`Expected a string, got ${typeof e}`);let{resolve:r=!0}=t,n=e;return r&&(n=q.default.resolve(e)),n=n.replace(/\\/g,"/"),n[0]!=="/"&&(n=`/${n}`),encodeURI(`file://${n}`).replace(/[?#]/g,encodeURIComponent)}var g=require("react/jsx-runtime"),Me=()=>(0,g.jsx)(u.Action.Open,{title:"Open System Preferences",icon:u.Icon.Gear,target:"x-apple.systempreferences:com.apple.preference.security?Privacy_AllFiles"}),We=()=>(0,g.jsx)(u.ActionPanel,{children:(0,g.jsx)(Me,{})}),De=`## Raycast needs automation access to iTerm.

1. Open **System Settings**
1. Open the **Privacy & Security** Preferences pane 
1. Then select the **Automation** tab
1. Expand **Raycast** from the list of applications
1. Ensure the **iTerm**  toggle is enabled as shown in the image below
1. When prompted enter your password

![Full Disk Access Preferences Pane](${z(Y.default.join(u.environment.assetsPath,"permission-raycast-automation.png"))})
`,X=e=>e.indexOf("Command failed with exit code 1: osascript -e")!==-1,Q=()=>(0,g.jsx)(u.Detail,{markdown:De,navigationTitle:"Permission Issue with Raycast",actions:(0,g.jsx)(We,{})});var ee=require("react"),P=require("@raycast/api"),R=({error:e})=>((0,ee.useEffect)(()=>{(async()=>await(0,P.showToast)({style:P.Toast.Style.Failure,title:"Error",message:e.message}))()},[]),null);var ne=require("react");var T=require("@raycast/api"),te=require("react"),re=({message:e})=>((0,te.useEffect)(()=>{(async()=>await(0,T.showToast)({style:T.Toast.Style.Animated,title:"Loading",message:e}))()},[]),null);var _=require("react/jsx-runtime"),ae=({loadingMessage:e="Sending iTerm command...",location:t="new-window",...r})=>{let{loading:n,success:a,error:s}=Z({...r,location:t});return(0,ne.useEffect)(()=>{a&&(async()=>(await(0,C.closeMainWindow)(),await(0,C.popToRoot)()))()},[a]),n?(0,_.jsx)(re,{message:e}):s?X(s.message)?(0,_.jsx)(Q,{}):(0,_.jsx)(R,{error:s}):null};var se=require("@raycast/api"),w=require("react"),ie=()=>{let[e,t]=(0,w.useState)([]),[r,n]=(0,w.useState)();return(0,w.useEffect)(()=>{(0,se.getSelectedFinderItems)().then(a=>a.length===0?n(new Error("No files selected")):t(a)).catch(a=>n(a))},[]),{items:e,error:r}};var k=require("react"),Fe=`
tell application "Finder"
    return POSIX path of (target of front Finder window as alias)
end tell
`,oe=()=>{let[e,t]=(0,k.useState)(""),[r,n]=(0,k.useState)();return(0,k.useEffect)(()=>{A(Fe).then(a=>t(a)).catch(()=>n(new Error("Finder not running")))},[]),{path:e,error:r}};var ce=require("@raycast/api"),le=require("path"),ue=require("fs"),b=require("react/jsx-runtime"),ze=e=>(0,ue.statSync)(e.path).isDirectory()?e.path:(0,le.dirname)(e.path);function fe(){let{items:e,error:t}=ie(),{path:r,error:n}=oe(),[a,s]=(0,x.useState)(new Set),{windowOrTab:i}=(0,ce.getPreferenceValues)();return(0,x.useEffect)(()=>{if(e.length){let o=new Set;e.forEach(c=>o.add(ze(c))),s(o)}},[e]),(0,x.useEffect)(()=>{t&&r.length&&s(new Set([r]))},[t,r]),t&&n?(0,b.jsx)(R,{error:n}):a.size?(0,b.jsx)(b.Fragment,{children:[...a].map(o=>(0,b.jsx)(ae,{command:`cd "${o}"`,loadingMessage:"Getting selected file(s)...",location:i},o))}):null}
